<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ç†è§£ Go è¯­è¨€ä¸­çš„ Slice Â· Minibase</title><meta name="description" content="ç†è§£ Go è¯­è¨€ä¸­çš„ Slice - Colafornia"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.colafornia.me/atom.xml" title="Minibase"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/colafornia" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ç†è§£ Go è¯­è¨€ä¸­çš„ Slice</h1><div class="post-info">Nov 5, 2019</div><div class="post-content"><p><img src="/images/go-slice.png" alt="go-slice"></p>
<p>æ•°ç»„æ˜¯é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹è¯­è¨€é‡Œæœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚</p>
<a id="more"></a>
<h2 id="ä¸€ã€ç¿»è½¦ç°åœº"><a href="#ä¸€ã€ç¿»è½¦ç°åœº" class="headerlink" title="ä¸€ã€ç¿»è½¦ç°åœº"></a>ä¸€ã€ç¿»è½¦ç°åœº</h2><p>åœ¨çŸ­æš‚çš„ Go è¯­è¨€å­¦ä¹ ä½¿ç”¨ä¸­ï¼Œå·²ç»è¿ç»­ä¸¤æ¬¡è¸©è¿›äº†ä¸‹é¢è¿™ä¸ªå‘</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vals := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">  vals = <span class="built_in">append</span>(vals, i)</div><div class="line">&#125;</div><div class="line"></div><div class="line">fmt.Println(vals)</div><div class="line"></div><div class="line"><span class="comment">// Playground: https://play.golang.org/p/7PgUqBdZ6Z</span></div></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœæ˜¯ <code>[0 0 0 0 0 0 1 2 3 4]</code></p>
<p><strong>å›é¡¾ä¸€ä¸‹ç¿»è½¦ç°åœºï¼š</strong></p>
<ol>
<li><p>å¼€å§‹æ˜¯é€šè¿‡ <code>var vals []int</code> æ¥è¿›è¡Œå˜é‡å£°æ˜</p>
</li>
<li><p>åç»­é€»è¾‘å¼€å‘å®Œæˆï¼Œè‡ªæµ‹å®Œæˆï¼Œä¸€åˆ‡ okï¼Œå‘å¸ƒä¸Šçº¿ï¼Œä¸€åˆ‡ ok</p>
</li>
<li><p>æŸå¤©åœ¨é¡¹ç›®é‡Œè·‘äº†ä¸€ä¸‹ <code>golangci-lint</code>ï¼Œå‘ç°äº†ä¸€å¨æŠ¥é”™ï¼Œå…¶ä¸­æœ‰ï¼š</p>
</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Consider preallocating <span class="string">`vals`</span> (prealloc)</div><div class="line">        <span class="keyword">var</span> vals []<span class="keyword">int</span></div><div class="line">        ^</div></pre></td></tr></table></figure>
<ol>
<li><p>é‚ä¿®æ”¹ä¸º <code>vals := make([]int, 5)</code>ï¼Œå†æ”¹å®Œé‚£ä¸€å¨æŠ¥é”™ï¼ŒåŸºæœ¬éƒ½æ˜¯å…³äºå†™æ³•çš„ä¿®æ­£ï¼Œlint ä¸å†æŠ¥é”™ï¼Œæäº¤å‘å¸ƒ</p>
</li>
<li><p>çº¿ä¸Šï¼ŒDuangğŸ’¥ğŸ’¥ğŸ’¥ï¼ˆçœ‹ç”¨åœ¨å“ªé‡Œå•¦ã€‚ã€‚å¾ˆæœ‰å¯èƒ½ä¹Ÿä¸ä¼šğŸ’¥ï¼Œåªä¼šæ˜¯ä¸€ä¸ªéšç§˜çš„ Bugï¼‰</p>
</li>
</ol>
<p>æŒºåˆºæ¿€çš„ã€‚ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™å…¶å®å·²ç»æœ‰ä¸ªå°è±¡ä¸èƒ½è¿™ä¹ˆå£°æ˜ sliceï¼Œå† append äº†ï¼Œä½†è¿˜æ˜¯è¢«æ‰“çš„ä¸å¤Ÿç–¼ï¼Œåˆæœ‰äº†ç¬¬äºŒæ¬¡ã€‚</p>
<p>æ‰€ä»¥è¿˜æ˜¯æ¥å­¦ä¹ ç†è§£ä¸€ä¸‹å…·ä½“æ˜¯æ€ä¹ˆå›äº‹å§ã€‚</p>
<h2 id="äºŒã€Array-vs-Slice"><a href="#äºŒã€Array-vs-Slice" class="headerlink" title="äºŒã€Array vs Slice"></a>äºŒã€Array vs Slice</h2><p>Go è¯­è¨€ä¸­æœ‰æ•°ç»„ arrayï¼Œä¹Ÿæœ‰åˆ‡ç‰‡ sliceã€‚äºŒè€…æœ‰å¾ˆå¤šåŒºåˆ«ï¼Œä½†æ˜¯æœ¬æ¬¡æƒ³è®¨è®ºçš„ä¸»è¦æ˜¯ï¼Œ<strong>array çš„å¤§å°æ˜¯å›ºå®šçš„ä¸”ä¸ä¼šæ”¹å˜ï¼Œå…¶ length å°±æ˜¯å…¶ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œè€Œ slice çš„å¤§å°æ˜¯åŠ¨æ€å˜åŒ–çš„</strong>ï¼Œå› ä¸º slice æ˜¯ array çš„ <strong>wrapper</strong>ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">aArray := [<span class="number">2</span>]<span class="keyword">string</span>&#123;<span class="string">"Tom"</span>, <span class="string">"Jerry"</span>&#125;</div><div class="line">fmt.Printf(<span class="string">"%T\n"</span>, aArray) <span class="comment">// Print "[2]string"</span></div></pre></td></tr></table></figure>
<p>æ‰€ä»¥è¯´ï¼Œå£°æ˜ä¸€ä¸ªæ•°ç»„ï¼š<code>var a [10]int</code> a çš„å¤§å°å°±å·²ç»å›ºå®šï¼Œä¸ä¼šæ”¹å˜ã€‚è°ƒç”¨ <code>len(a)</code> çš„ç»“æœæ°¸è¿œä¸º 10ã€‚å¦‚æœæƒ³è¦å†å‘æ•°ç»„é‡Œæ·»åŠ ã€åˆ é™¤ä»»ä½•å…ƒç´ ï¼Œéƒ½å¿…é¡»è¦é‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„ç±»å‹ã€‚</p>
<p>è¿™ç§å›ºå®šå¤§å°çš„æ•°ç»„è®¾è®¡åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼ˆå®˜æ–¹æ–‡æ¡£çš„ä¸¾ä¾‹æ˜¯çŸ©é˜µå˜æ¢ï¼‰ï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå·¥ç¨‹ä¸­è¿˜æ˜¯éœ€è¦ä¸€ä¸ªå¯å˜å¤§å°å¯å¢åˆ çš„æ•°ç»„å®¹å™¨ã€‚è€Œè¿™å°±æ˜¯è®¾è®¡ Slice çš„åŸå› ã€‚</p>
<p>åˆ‡ç‰‡ Slice æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œå®ƒæè¿°äº†æ•°ç»„çš„ä¸€ä¸ªè¿ç»­ç‰‡æ®µï¼Œæ‰€ä»¥å«åˆ‡ç‰‡è¿˜æ˜¯å¾ˆç”ŸåŠ¨å½¢è±¡çš„ã€‚åˆ‡ç‰‡å…¶å®å°±æ˜¯åŠ¨æ€æ•°ç»„ï¼Œå®ƒçš„é•¿åº¦å¹¶ä¸å›ºå®šï¼Œå¯ä»¥è¿½åŠ å…ƒç´ å¹¶ä¼šåœ¨åˆ‡ç‰‡å®¹é‡ä¸è¶³æ—¶è¿›è¡Œæ‰©å®¹ã€‚</p>
<p><img src="http://static.git-star.com/go-slices-usage-and-internals_slice-struct.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾ï¼Œ<code>Slice</code> çš„ç»“æ„æœ¬è´¨ä¸Šæ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> SliceHeader <span class="keyword">struct</span> &#123;</div><div class="line">    Ptr <span class="keyword">uintptr</span></div><div class="line">    Len  <span class="keyword">int</span></div><div class="line">    Cap  <span class="keyword">int</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Ptr ä½œä¸ºä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå…¶å®å°±æ˜¯æŒ‡å‘ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè¿™ç‰‡å†…å­˜ç©ºé—´å¯ä»¥ç”¨äºå­˜å‚¨åˆ‡ç‰‡ä¸­ä¿å­˜çš„å…¨éƒ¨å…ƒç´ ï¼Œæ•°ç»„å…¶å®å°±æ˜¯ä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ åªæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œåº•å±‚å­˜å‚¨å…¶å®éƒ½æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‰‡ç†è§£æˆä¸€ç‰‡è¿ç»­çš„å†…å­˜ç©ºé—´åŠ ä¸Šé•¿åº¦ä¸å®¹é‡æ ‡è¯†ã€‚</p>
<p>Length æ˜¯ slice ä¸­æ‰€åŒ…å«çš„å…ƒç´ ä¸ªæ•°ï¼Œè€Œ<code>Capacity</code>åˆ™è®°å½•äº†å…¶åº•å±‚æ•°ç»„çš„å¤§å°ï¼ˆä»åˆ‡ç‰‡æŒ‡é’ˆå¼•ç”¨çš„å…ƒç´ å¼€å§‹ï¼Œç›´åˆ°åº•å±‚æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ã€‚å› æ­¤ï¼Œå¿…ç„¶ä¼šæœ‰ <code>Capacity &gt;= Length</code> ã€‚è¯•å›¾æŠŠåˆ‡ç‰‡æ‰©å±•åˆ°è¶…å‡ºå®¹é‡å°±ä¼šå’Œè®¿é—®è¶…å‡ºæ•°ç»„/åˆ‡ç‰‡èŒƒå›´çš„ç´¢å¼•ä¸€æ ·ï¼Œå¯¼è‡´ panicã€‚</p>
<p>å› æ­¤å¦‚æœæˆ‘ä»¬å£°æ˜ <code>slice := iBuffer[0:0]</code>ï¼Œå…¶ header åˆ™ä¸ºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">slice := SliceHeader&#123;</div><div class="line">    Len:  <span class="number">0</span>,</div><div class="line">    Cap:  <span class="number">10</span>,</div><div class="line">    Ptr: &amp;iBuffer[<span class="number">0</span>],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¼•å…¥ slice header çš„è¿™ä¸ªæ¦‚å¿µéå¸¸æœ‰åŠ©äºç†è§£ slice çš„ç‰¹ç‚¹å’Œä¸€äº›å‘ã€‚</p>
<p>å†æ¥çœ‹çœ‹å‡ ç§å£°æ˜ slice çš„æ–¹å¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å­—é¢é‡</span></div><div class="line">letters := []<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>&#125;</div><div class="line"></div><div class="line"><span class="comment">// make</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">([]T, <span class="built_in">len</span>, <span class="built_in">cap</span>)</span> []<span class="title">T</span></span></div><div class="line"><span class="title">s</span> := <span class="title">make</span><span class="params">([]<span class="keyword">byte</span>, 5)</span></div><div class="line"></div><div class="line">// <span class="title">re</span>-<span class="title">slice</span></div><div class="line"><span class="title">s</span> = <span class="title">s</span>[2:4]</div></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰ç§ re-slice æ–¹å¼å¹¶æ²¡æœ‰æ‹·è´åŸ slice ä¸­çš„æ•°æ®ï¼Œå®ƒåªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åˆ‡ç‰‡ï¼Œå¹¶å°†å…¶æŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚</p>
<p>å¦‚æœæ›´æ”¹äº† slice ä¸­æŸäº›å…ƒç´ çš„å€¼ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ”¹å˜ slice æ‰€æŒ‡å‘çš„æ•°ç»„å…ƒç´ çš„å€¼ã€‚å› æ­¤ï¼Œåœ¨ä¸‹é¢è¿™ç§é€šè¿‡ re-slice ç”Ÿæˆäº†å­åˆ‡ç‰‡ï¼Œåˆé€šè¿‡ç´¢å¼•ä¿®æ”¹å…ƒç´ å€¼çš„è¡Œä¸ºï¼Œä¼šå¯¼è‡´æ‰€æœ‰æŒ‡å‘è¿™ä¸ªåº•å±‚æ•°ç»„çš„ slice çš„å€¼éƒ½å‘ç”Ÿæ”¹å˜ã€‚<strong>å³ Slice çš„ç»“æ„ä¼šå¯¼è‡´å¤šä¸ª slice å®é™…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªæ•°ç»„ï¼Œè¦è°¨æ…ä¿®æ”¹ slice ä¸­å…ƒç´ çš„å€¼</strong>ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">foo = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>) <span class="comment">// è¢«åˆå§‹åŒ–ä¸º [0 0 0 0 0]</span></div><div class="line">foo[<span class="number">3</span>] = <span class="number">42</span></div><div class="line">foo[<span class="number">4</span>] = <span class="number">100</span></div><div class="line">bar  := foo[<span class="number">1</span>:<span class="number">4</span>]</div><div class="line">bar[<span class="number">1</span>] = <span class="number">99</span></div><div class="line">fmt.Println(foo) <span class="comment">// [0 0 99 42 100]</span></div><div class="line">fmt.Println(bar) <span class="comment">// [0 99 42]</span></div></pre></td></tr></table></figure>
<h2 id="ä¿®æ”¹-Slice-ä¸­å…ƒç´ çš„å€¼ä¸-header"><a href="#ä¿®æ”¹-Slice-ä¸­å…ƒç´ çš„å€¼ä¸-header" class="headerlink" title="ä¿®æ”¹ Slice ä¸­å…ƒç´ çš„å€¼ä¸ header"></a>ä¿®æ”¹ Slice ä¸­å…ƒç´ çš„å€¼ä¸ header</h2><p>ä¿®æ”¹è¿™ä¸¤è€…çš„æ–¹æ³•å¹¶ä¸ä¸€æ ·ã€‚</p>
<h3 id="Example1-å°†-slice-ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹-slice-ä¸­å…ƒç´ çš„å€¼"><a href="#Example1-å°†-slice-ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹-slice-ä¸­å…ƒç´ çš„å€¼" class="headerlink" title="Example1:  å°† slice ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹ slice ä¸­å…ƒç´ çš„å€¼"></a>Example1:  å°† slice ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹ slice ä¸­å…ƒç´ çš„å€¼</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddOneToEachElement</span><span class="params">(slice [])</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> slice &#123;</div><div class="line">        slice[i]++</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    slice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</div><div class="line">    fmt.Println(<span class="string">"before"</span>, slice)</div><div class="line">    AddOneToEachElement(slice)</div><div class="line">    fmt.Println(<span class="string">"after"</span>, slice)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// before [0 0 0 0 0]</span></div><div class="line"><span class="comment">// after [1 1 1 1 1]</span></div></pre></td></tr></table></figure>
<p>ä¿®æ”¹æˆåŠŸã€‚è™½ç„¶ä½œä¸ºå‡½æ•°å‚æ•°æ‰€ä¼ é€’çš„åªæ˜¯ slice çš„å€¼ï¼Œä½†æ˜¯å…¶å®åœ¨å‡½æ•°ä¸­æˆ‘ä»¬æ‰€æ“ä½œä¿®æ”¹çš„æ˜¯æŒ‡å‘åŒä¸€åº•å±‚æ•°ç»„çš„ <code>newSlice</code>ï¼Œåº•å±‚æ•°ç»„çš„å…ƒç´ è¢«ä¿®æ”¹ï¼Œå› æ­¤å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œä¿®æ”¹åçš„å…ƒç´ å€¼å¯ç”±åŸ slice è®¿é—®åˆ°ã€‚</p>
<h3 id="Example2-å°†-slice-ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹-slice-çš„é•¿åº¦"><a href="#Example2-å°†-slice-ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹-slice-çš„é•¿åº¦" class="headerlink" title="Example2:  å°† slice ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹ slice çš„é•¿åº¦"></a>Example2:  å°† slice ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹ slice çš„é•¿åº¦</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">SubtractOneFromLength</span><span class="params">(slice []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</div><div class="line">    slice = slice[<span class="number">0</span> : <span class="built_in">len</span>(slice)<span class="number">-1</span>]</div><div class="line">    <span class="keyword">return</span> slice</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    slice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</div><div class="line">    fmt.Println(<span class="string">"Before: len(slice) ="</span>, <span class="built_in">len</span>(slice))</div><div class="line">    newSlice := SubtractOneFromLength(slice)</div><div class="line">    fmt.Println(<span class="string">"After:  len(slice) ="</span>, <span class="built_in">len</span>(slice))</div><div class="line">    fmt.Println(<span class="string">"After:  len(newSlice) ="</span>, <span class="built_in">len</span>(newSlice))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Before: len(slice) = 5</span></div><div class="line"><span class="comment">// After:  len(slice) = 5</span></div><div class="line"><span class="comment">// After:  len(newSlice) = 4</span></div></pre></td></tr></table></figure>
<p>å‚¨å­˜åœ¨ slice header ä¸­çš„ length å±æ€§å¹¶ä¸ä¼šè¢«å‡½æ•°ä¿®æ”¹ï¼Œä¼ å…¥å‡½æ•°çš„åªæ˜¯å…¶æ‹·è´ã€‚ å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡ä¸€ä¸ªå‡½æ•°æ¥ä¿®æ”¹ slice  çš„ header çš„è¯ï¼Œå¿…é¡»é€šè¿‡æŠŠä¿®æ”¹è¿‡çš„è¿”å›ç»“æœé‡æ–°èµ‹å€¼ç»™å¾…ä¿®æ”¹çš„ sliceã€‚</p>
<h3 id="Example3-å°†-slice-çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹å…¶-header"><a href="#Example3-å°†-slice-çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹å…¶-header" class="headerlink" title="Example3:  å°† slice çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹å…¶ header"></a>Example3:  å°† slice çš„æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ï¼Œä¿®æ”¹å…¶ header</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">PtrSubtractOneFromLength</span><span class="params">(slicePtr *[]<span class="keyword">int</span>)</span></span> &#123;</div><div class="line">	slice := *slicePtr</div><div class="line">	*slicePtr = slice[<span class="number">0</span> : <span class="built_in">len</span>(slice)<span class="number">-1</span>]</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	slice := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</div><div class="line">	fmt.Println(<span class="string">"Before: len(slice) ="</span>, <span class="built_in">len</span>(slice))</div><div class="line">	PtrSubtractOneFromLength(&amp;slice)</div><div class="line">	fmt.Println(<span class="string">"After:  len(slice) ="</span>, <span class="built_in">len</span>(slice))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Before: len(slice) = 5</span></div><div class="line"><span class="comment">// After:  len(slice) = 4</span></div></pre></td></tr></table></figure>
<h2 id="ä¸‰ã€Append"><a href="#ä¸‰ã€Append" class="headerlink" title="ä¸‰ã€Append"></a>ä¸‰ã€Append</h2><p>å†…ç½®çš„ <code>append</code>æ–¹æ³•æœ‰è¿™å‡ ä¸ªåŠŸèƒ½ç‰¹ç‚¹ï¼š</p>
<ol>
<li>å‘ slice é™„åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ </li>
<li>åˆ†é…è¶³å¤Ÿå¤§çš„ slice ï¼ˆå¦‚æœ append åçš„é•¿åº¦è¶…å‡ºäº†ç°æœ‰çš„å®¹é‡ï¼‰</li>
<li>æ€»ä¼šæˆåŠŸï¼Œé™¤éæœºå™¨å†…å­˜è€—å…‰</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// è¿™æ˜¯å®˜æ–¹å®ç°çš„ç”¨æ¥è¯´æ˜åŠŸèƒ½ç‰¹æ€§çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸æ˜¯æºç </span></div><div class="line"><span class="comment">// Append appends the elements to the slice.</span></div><div class="line"><span class="comment">// Efficient version.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Append</span><span class="params">(slice []<span class="keyword">int</span>, elements ...<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</div><div class="line">    n := <span class="built_in">len</span>(slice)</div><div class="line">    total := <span class="built_in">len</span>(slice) + <span class="built_in">len</span>(elements)</div><div class="line">    <span class="keyword">if</span> total &gt; <span class="built_in">cap</span>(slice) &#123;</div><div class="line">        <span class="comment">// Reallocate. Grow to 1.5 times the new size, so we can still grow.</span></div><div class="line">        <span class="comment">// ä¸€æ¬¡åˆ†é…æ›´å¤šçš„å†…å­˜é€šå¸¸éƒ½æ¯”å¤šæ¬¡åˆ†é…å°‘é‡å†…å­˜çš„å¼€é”€æ›´å°ä¸”é€Ÿåº¦æ›´å¿«</span></div><div class="line">        newSize := total*<span class="number">3</span>/<span class="number">2</span> + <span class="number">1</span></div><div class="line">        newSlice := <span class="built_in">make</span>([]<span class="keyword">int</span>, total, newSize)</div><div class="line">        <span class="built_in">copy</span>(newSlice, slice)</div><div class="line">        slice = newSlice</div><div class="line">    &#125;</div><div class="line">    slice = slice[:total]</div><div class="line">    <span class="built_in">copy</span>(slice[n:], elements)</div><div class="line">    <span class="keyword">return</span> slice</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="å››ã€å›é¡¾ä¸€ä¸‹ç¿»è½¦ç°åœº"><a href="#å››ã€å›é¡¾ä¸€ä¸‹ç¿»è½¦ç°åœº" class="headerlink" title="å››ã€å›é¡¾ä¸€ä¸‹ç¿»è½¦ç°åœº"></a>å››ã€å›é¡¾ä¸€ä¸‹ç¿»è½¦ç°åœº</h2><p>å›åˆ°æˆ‘ä»¬ä¸€å¼€å§‹æ¼”ç¤ºç¿»è½¦ç°åœºçš„ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vals := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">  vals = <span class="built_in">append</span>(vals, i)</div><div class="line">&#125;</div><div class="line">fmt.Println(vals)</div></pre></td></tr></table></figure>
<p>åœ¨å£°æ˜ <code>vals</code> çš„æ—¶å€™ï¼ŒæŠŠå®ƒçš„ <code>length</code> å’Œ <code>capacity</code>éƒ½è®¾ç½®ä¸º5ï¼Œå®ƒè¢«åˆå§‹åŒ–ä¸ºç©ºå€¼ slice : <code>[0 0 0 0 0]</code>ï¼Œå†è¿›è¡Œ append æ“ä½œï¼Œå®ƒå‡è®¾æˆ‘ä»¬æ˜¯æƒ³åœ¨åˆå§‹çš„ 5 ä¸ªå…ƒç´ åæ·»åŠ æ–°å…ƒç´ ï¼Œå› æ­¤å¾—åˆ°çš„ç»“æœæ˜¯ <code>[0 0 0 0 0 0 1 2 3 4]</code>ã€‚</p>
<p>é‚£åœ¨ golang-lint è¦æ±‚æˆ‘ä»¬å¿…é¡»é€šè¿‡ <code>prealloc</code> çš„æ–¹å¼åˆå§‹åŒ– valsï¼Œæˆ–æ˜¯æˆ‘ä»¬ä¸ºäº†é¿å…æ¯ä¸ªå¾ªç¯ä¸­éƒ½ re-allocate é€ æˆçš„è¿‡å¤§å¼€é”€ï¼Œæˆ–æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šæ‰§è¡Œ<code>append</code> åçš„åˆ‡ç‰‡å¤§å°çš„æƒ…å†µä¸‹ï¼Œè¦æ€ä¹ˆé¿å…è¿™ç§ç¿»è½¦æƒ…å†µå‘¢ï¼Ÿ</p>
<p>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<h3 id="1-ç›´æ¥é€šè¿‡ç´¢å¼•å¯¹åˆ‡ç‰‡å…ƒç´ èµ‹å€¼ï¼ˆåªé’ˆå¯¹éå†æ“ä½œåçš„æ•°ç»„å¤§å°å·²çŸ¥çš„æƒ…å†µï¼‰"><a href="#1-ç›´æ¥é€šè¿‡ç´¢å¼•å¯¹åˆ‡ç‰‡å…ƒç´ èµ‹å€¼ï¼ˆåªé’ˆå¯¹éå†æ“ä½œåçš„æ•°ç»„å¤§å°å·²çŸ¥çš„æƒ…å†µï¼‰" class="headerlink" title="1. ç›´æ¥é€šè¿‡ç´¢å¼•å¯¹åˆ‡ç‰‡å…ƒç´ èµ‹å€¼ï¼ˆåªé’ˆå¯¹éå†æ“ä½œåçš„æ•°ç»„å¤§å°å·²çŸ¥çš„æƒ…å†µï¼‰"></a>1. ç›´æ¥é€šè¿‡ç´¢å¼•å¯¹åˆ‡ç‰‡å…ƒç´ èµ‹å€¼ï¼ˆåªé’ˆå¯¹éå†æ“ä½œåçš„æ•°ç»„å¤§å°å·²çŸ¥çš„æƒ…å†µï¼‰</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vals := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">  vals[i] = i</div><div class="line">&#125;</div><div class="line">fmt.Println(vals)</div></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ¡ˆå¹¶ä¸éš¾ç†è§£ã€‚</p>
<h3 id="2-è®¾ç½®é•¿åº¦ä¸º-0ï¼ŒæŒ‡å®šåˆ‡ç‰‡çš„-Capacity"><a href="#2-è®¾ç½®é•¿åº¦ä¸º-0ï¼ŒæŒ‡å®šåˆ‡ç‰‡çš„-Capacity" class="headerlink" title="2. è®¾ç½®é•¿åº¦ä¸º 0ï¼ŒæŒ‡å®šåˆ‡ç‰‡çš„ Capacity"></a>2. è®¾ç½®é•¿åº¦ä¸º <code>0</code>ï¼ŒæŒ‡å®šåˆ‡ç‰‡çš„ Capacity</h3><p>å¹¶ä¸æ˜¯æ‰€æœ‰åœºæ™¯ä¸‹æˆ‘ä»¬éƒ½å¯ä»¥ç²¾ç¡®ä¸€ä¸€å¯¹åº”åˆ°æ¯ä¸ªç´¢å¼•ä¸‹è¯¥å­˜å‚¨çš„å…ƒç´ æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚è¯´ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vals := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>)</div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">  items := getItems(i)</div><div class="line">  vals = <span class="built_in">append</span>(vals, items...)</div><div class="line">&#125;</div><div class="line">fmt.Println(vals)</div></pre></td></tr></table></figure>
<p>æ¯æ¬¡å°†ä¸€ä¸ªä¸å®šé•¿åº¦çš„ slice é“ºå¹³è¿½åŠ åˆ°åˆ‡ç‰‡ï¼Œæœ€ç»ˆå¾—åˆ°çš„åˆ‡ç‰‡çš„é•¿åº¦æ— æ³•æå‰ç¡®å®šã€‚</p>
<p>é‚£åªèƒ½é€šè¿‡è®¾ç½®é•¿åº¦ä¸º <code>0</code>ï¼ŒæŒ‡å®šåˆ‡ç‰‡çš„å®¹é‡æ¥è§£å†³äº†ã€‚å³ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vals := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">5</span>)</div><div class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</div><div class="line">  items := getItems(i)</div><div class="line">  vals = <span class="built_in">append</span>(vals, items...)</div><div class="line">&#125;</div><div class="line">fmt.Println(vals)</div></pre></td></tr></table></figure>
<p>å½“ç„¶æˆ‘ä»¬åˆå§‹åŒ–æ—¶æŒ‡å®šçš„å®¹é‡5å¾ˆæœ‰å¯èƒ½æ¯”æœ€ç»ˆåˆ‡ç‰‡é•¿åº¦å°ï¼Œå¾ªç¯è¿‡ç¨‹ä¸­è¿˜æ˜¯ä¼šå‘ç”Ÿ re-allocateï¼Œä½†è¿™æ ·å·²ç»é¿å…äº†å‰é¢çš„ç¿»è½¦ç°åœºï¼Œä¹Ÿå‡å°‘äº† re-allocate æ¬¡æ•°ï¼Œå¯ä»¥ä½œä¸ºè¿™ç§åœºæ™¯ä¸‹çš„æŠ˜ä¸­è§£å†³æ–¹æ¡ˆäº†ã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ul>
<li><a href="https://blog.golang.org/slices" target="_blank" rel="external">Arrays, slices (and strings): The mechanics of â€˜appendâ€™</a></li>
<li><a href="https://blog.golang.org/go-slices-usage-and-internals" target="_blank" rel="external">Go Slices: usage and internals</a></li>
<li><a href="https://www.calhoun.io/how-to-use-slice-capacity-and-length-in-go/" target="_blank" rel="external">How to use slice capacity and length in Go</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/post/2019/2019-review/" class="prev">PREV</a><a href="/post/2019/e2e-test-cypress/" class="next">NEXT</a></div><div class="copyright"><p>Â© 2015 - 2020 <a href="https://blog.colafornia.me">Colafornia</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-84469017-1",'auto');ga('send','pageview');</script></body></html>