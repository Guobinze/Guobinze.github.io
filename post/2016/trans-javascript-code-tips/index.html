<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> [译]JavaScript最佳实践：提高代码质量的技巧和建议 · Minibase</title><meta name="description" content="[译]JavaScript最佳实践：提高代码质量的技巧和建议 - Colafornia"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.colafornia.me/atom.xml" title="Minibase"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/colafornia" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">[译]JavaScript最佳实践：提高代码质量的技巧和建议</h1><div class="post-info">Mar 13, 2016</div><div class="post-content"><p>原文地址：<a href="https://www.codementor.io/javascript/tutorial/javascript-best-practices" target="_blank" rel="external">https://www.codementor.io/javascript/tutorial/javascript-best-practices</a></p>
<p><img src="https://www.filepicker.io/api/file/e4jxgEgHRzS1zQU6aJLR" alt="image"><br>每天学习新知识可以让我们变成一个更优秀更理性的人。作为一名开发者，持续学习也是我们工作的一部分，无论如何，这些新知识的学习过程都是积极有益的经验积累。</p>
<p>在这篇教程中，我会提出一些JavaScript的最佳实践，你就不会觉得学习起来很困难了。准备好了就来一起升级你的代码吧！</p>
<h3 id="1-避免污染全局作用域"><a href="#1-避免污染全局作用域" class="headerlink" title="1.避免污染全局作用域"></a>1.避免污染全局作用域</h3><p>声明变量的过程中有很多有趣的地方。有的时候，你可能在不知情的情况下却声明了一个<code>全局变量</code>。在现代浏览器中，全局变量会被储存在<code>window</code>对象中，因此会有很多内容运行在其中，你不知情声明的全局变量可能会覆盖掉一些默认值。</p>
<a id="more"></a>
<p>我们假设你有一个包含<code>&lt;script&gt;</code>标签的HTML文件（或者是其中引入了JavaScript文件）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var foo = 42;</div><div class="line">console.log(foo);</div></pre></td></tr></table></figure></p>
<p>很明显，控制台会打印出<code>42</code>，但是如果这段代码不是执行在函数中的话，这一段执行上下文就会变成全局的。因此，这个变量<code>foo</code>也会被绑定在<code>window</code>对象上，意味着<code>window.foo</code>也是<code>42</code>。这样是很危险的，你可能覆盖掉了已经存在的全局变量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">function print () &#123;</div><div class="line">   // do something</div><div class="line">&#125;</div><div class="line">print();</div></pre></td></tr></table></figure></p>
<p>当执行<code>windos.print</code>（或者<code>print</code>）时，由于我们已经覆盖了原生的print函数，浏览器就不会弹出打印窗口了。</p>
<p>解决方法很简单；我们需要一个叫做<code>立即执行函数</code>的包装函数，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Declare an anonymous function</div><div class="line">(function () &#123;</div><div class="line">   var foo = 42;</div><div class="line">   console.log(window.foo);</div><div class="line">   // → undefined</div><div class="line">   console.log(foo);</div><div class="line">   // → 42</div><div class="line">&#125;)();</div><div class="line">//^ and call it immediately</div></pre></td></tr></table></figure></p>
<p>除了这种解决方法，你也可以选择把<code>window</code>和其它全局对象（如<code>document</code>）作为参数传递给函数（这样可能会提升性能）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(function (global, doc) &#123;</div><div class="line">  global.setTimeout(function () &#123;</div><div class="line">     doc.body.innerHTML = &quot;Hello!&quot;;</div><div class="line">  &#125;, 1000);</div><div class="line">&#125;)(window, document);</div></pre></td></tr></table></figure></p>
<p>因此，你要用包裹函数避免创建全局变量。注意一点，我不会在代码段中使用包裹函数，因为我们是要专注于代码本身。</p>
<p>Tip: <a href="http://browserify.org/" target="_blank" rel="external">模块打包工具browserify</a>是避免创建全局变量的又一种方法。它以与Node.js同样的方式使用<code>require</code>函数。</p>
<p>多说一点，Node.js通过函数来自动包裹你的文件。它们看起来就像这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(function (exports, require, module, __filename, __dirname) &#123;</div><div class="line">// ...</div></pre></td></tr></table></figure></p>
<p>可能你觉得<code>require</code>函数也是全局的，然而它并不是。它只不过是一个函数参数。</p>
<h4 id="Did-you-know"><a href="#Did-you-know" class="headerlink" title="Did you know?"></a>Did you know?</h4><p>尽管<code>window</code>对象其中包含着全局变量，它本身也是个全局变量，<code>window</code>内部指向的是它本身：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">window.window.window</div><div class="line">// =&gt; Window&#123;...&#125;</div></pre></td></tr></table></figure>
<p>这是因为<code>window</code>是一个循环对象。想要创建一个循环对象的话可以参考：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// 创建一个对象</div><div class="line">var foo = &#123;&#125;;</div><div class="line"></div><div class="line">//给对象本身赋值一个属性</div><div class="line">foo.bar = foo;</div><div class="line"></div><div class="line">// foo就变成了一个循环对象</div><div class="line">foo.bar.bar.bar.bar</div><div class="line">// → foo</div></pre></td></tr></table></figure></p>
<p>所以你可以这样表白你对JavaScripte无限的爱了：<br><img src="https://www.filepicker.io/api/file/ZMNjGIiQ52IKsseTjqno" alt="circle"><br>你就可以像这样无限扩展这个Object（直到浏览器崩溃）</p>
<h3 id="2-使用’use-strict’的好处"><a href="#2-使用’use-strict’的好处" class="headerlink" title="2.使用’use strict’的好处"></a>2.使用’use strict’的好处</h3><p>严格使用<code>use strict</code>！没有什么方法比把这行代码添在JavaScript里可以让你的代码更magic了。</p>
<p>举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//  糟糕的写法，会让你在不知情的情况下创建了全局变量</div><div class="line">(function () &#123;</div><div class="line">   a = 42;</div><div class="line">   console.log(a);</div><div class="line">   // → 42</div><div class="line">&#125;)();</div><div class="line">console.log(a);</div><div class="line">// → 42</div></pre></td></tr></table></figure></p>
<p>设置严格模式，你就会得到报错信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(function () &#123;</div><div class="line">   &quot;use strict&quot;;</div><div class="line">   a = 42;</div><div class="line">   // Error: Uncaught ReferenceError: a is not defined</div><div class="line">&#125;)();</div></pre></td></tr></table></figure></p>
<p>你可能想知道为什么你不能把<code>&quot;use strict&quot;</code>写在包裹函数外面。事实上，可以写在外面，严格模式就会在全局应用。这么什么不好的，但是要注意如果代码引入了第三方库，或是要打包到一个文件的时候，全局应用可能会造成影响。</p>
<h3 id="3-严格等于"><a href="#3-严格等于" class="headerlink" title="3.严格等于 ==="></a>3.严格等于 ===</h3><p>如果你想用<code>==</code>来比较a和b的话，在JavaScript中你可能会发现它的结果有点奇怪：如果你比较的是字符串和数字，它们也会是相等的（<code>==</code>）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&quot;42&quot; == 42</div><div class="line">// true</div></pre></td></tr></table></figure></p>
<p>显然，用严格等于（<code>===</code>）更好<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&quot;42&quot; === 42</div><div class="line">// false</div></pre></td></tr></table></figure></p>
<h3 id="4-用-amp-amp-和-魔法"><a href="#4-用-amp-amp-和-魔法" class="headerlink" title="4.用&amp;&amp;和||魔法"></a>4.用<code>&amp;&amp;</code>和<code>||</code>魔法</h3><p>在日常工作中，你可以发现用逻辑操作符缩短你的代码</p>
<p>默认<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&quot;&quot; || &quot;foo&quot;   // → &quot;foo&quot;</div><div class="line"></div><div class="line">undefined || 42   // → 42</div><div class="line"></div><div class="line">//注意一下，如果你想通过这种方式来处理0的话，你要检查它是0还是未赋值</div><div class="line">var a = 0;</div><div class="line">a || 42</div><div class="line">// → 42</div><div class="line"></div><div class="line">// 三元表达式看起来就像是一行结构的if-else语句</div><div class="line">var b = typeof a === &quot;number&quot; ? a : 42;</div><div class="line">// → 0</div></pre></td></tr></table></figure></p>
<p>不需要用if表达式来判断布尔值，你可以简单地这样处理：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">expr &amp;&amp; doSomething();</div><div class="line"></div><div class="line">// Instead of:</div><div class="line">if (expr) &#123;</div><div class="line">   doSomething();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在上例中如果我们需要<code>doSomething()</code>来返回结果的话，使用逻辑操作符会看起来更带感：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">function doSomething () &#123;</div><div class="line">   return &#123; foo: &quot;bar&quot; &#125;;</div><div class="line">&#125;</div><div class="line">var expr = true;</div><div class="line">var res = expr &amp;&amp; doSomething();</div><div class="line">res &amp;&amp; console.log(res);</div><div class="line">// → &#123; foo: &quot;bar&quot; &#125;</div></pre></td></tr></table></figure></p>
<p>在这个问题上你可能会有异议，但使用逻辑操作符确实是更理想的方式。可能你认为用这种方法是“丑化”代码，但那些代码压缩器却真的在这样做。</p>
<p>尽管代码变短了，它的可读性却依然很好。</p>
<h3 id="5-改变变量类型"><a href="#5-改变变量类型" class="headerlink" title="5.改变变量类型"></a>5.改变变量类型</h3><p>取决于实际场景，有很多改变变量类型的方法，如下是最常用的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">// anything =》 number</div><div class="line"></div><div class="line">var foo = &quot;42&quot;;</div><div class="line">var myNumber = +foo; // shortcut for Number(foo)</div><div class="line">// → 42</div><div class="line"></div><div class="line">// Tip: 可以直接把它变成负数</div><div class="line">var negativeFoo = -foo; // or -Number(foo)</div><div class="line">// → -42</div><div class="line"></div><div class="line">// object =&gt; array</div><div class="line">// Tip: `arguments` 是一个对象但通常被用作为数组</div><div class="line">var args = &#123; 0: &quot;foo&quot;, 1: &quot;bar&quot;, length: 2 &#125;;</div><div class="line">Array.prototype.slice.call(args)</div><div class="line">// → [ &apos;foo&apos;, &apos;bar&apos; ]</div><div class="line"></div><div class="line">// Anything =》 boolean</div><div class="line">// 两次取非可以使它变成布尔值</div><div class="line">var t = 1;</div><div class="line">var f = 0;</div><div class="line">!!t</div><div class="line">// → true</div><div class="line">!!f</div><div class="line">// → false</div><div class="line"></div><div class="line">// 一次取非</div><div class="line">!t</div><div class="line">// → false</div><div class="line">!f</div><div class="line">// → true</div><div class="line"></div><div class="line">// Anything =》 string</div><div class="line">var foo = 42;</div><div class="line">&quot;&quot; + foo // 转变为字符串的简短方法</div><div class="line">// → &quot;42&quot;</div><div class="line"></div><div class="line">foo = &#123; hello: &quot;world&quot; &#125;;</div><div class="line">JSON.stringify(foo);</div><div class="line">// → &apos;&#123; &quot;hello&quot;:&quot;world&quot; &#125;&apos;</div><div class="line"></div><div class="line">JSON.stringify(foo, null, 4); // 美化代码</div><div class="line">// →</div><div class="line">// &apos;&#123;</div><div class="line">//    &quot;hello&quot;: &quot;world&quot;</div><div class="line">// &#125;&apos;</div><div class="line"></div><div class="line">// 注意一点，不可以 JSON.stringify 环形结构的对象</div><div class="line">JSON.stringify(window);</div><div class="line">// ⚠ TypeError: JSON.stringify cannot serialize cyclic structures.</div></pre></td></tr></table></figure></p>
<h3 id="6-代码风格指南"><a href="#6-代码风格指南" class="headerlink" title="6.代码风格指南"></a>6.代码风格指南</h3><p>新项目中在不同文件里应该遵循同样的代码风格，对于老项目，就沿用旧的代码风格，除非你下定决心去整体改掉陈旧代码的风格（要和同事讨论之后再决定）。只要你确定了代码风格，就要一直遵循它。</p>
<p>这是一些可参考的代码风格</p>
<ul>
<li><a href="https://google.github.io/styleguide/javascriptguide.xml" target="_blank" rel="external">Google JavaScript Style Guide</a></li>
<li><a href="https://github.com/airbnb/javascript" target="_blank" rel="external">aribnb/javascript</a></li>
<li><a href="https://github.com/IonicaBizau/code-style" target="_blank" rel="external">my code-style</a></li>
</ul>
<h3 id="额外提示"><a href="#额外提示" class="headerlink" title="额外提示"></a>额外提示</h3><p>在其它一些JavaScript最佳实践中可以发现有一些有助于编码的工具：</p>
<ul>
<li><a href="https://github.com/beautify-web/js-beautify" target="_blank" rel="external">js-beautify</a>:美化代码</li>
<li><a href="https://github.com/mishoo/UglifyJS2" target="_blank" rel="external">UglifyJS(2)</a>:压缩代码</li>
<li><a href="https://github.com/jshint/jshint" target="_blank" rel="external">jshint</a>:检测代码中的错误</li>
<li><a href="http://jscs.info/" target="_blank" rel="external">jscs</a>:可扩展的风格检测</li>
</ul>
<p>最后一件事，好好<a href="https://www.codementor.io/learn-programming/what-to-do-when-your-website-is-broken" target="_blank" rel="external">debug</a>,而不是用<code>console.log</code></p>
<p>祝编码愉快！</p>
<h3 id="参考内容"><a href="#参考内容" class="headerlink" title="参考内容"></a>参考内容</h3><ul>
<li><a href="https://www.codementor.io/javascript/tutorial/how-to-learn-javascript-properly" target="_blank" rel="external">初学者指南：学习JavaScript的最佳方法</a></li>
<li><a href="https://www.codementor.io/javascript/tutorial/top-ten-things-beginners-must-know-javascript" target="_blank" rel="external">关于JavaScript初学者必知的十件事</a></li>
<li><a href="https://www.codementor.io/learn-programming/javascript-trends-skills-developers-should-learn" target="_blank" rel="external">在2016年JavaScript开发者需要学习的技巧</a></li>
<li><a href="https://www.codementor.io/javascript/tutorial/4-easy-ways-to-start-using-es2015" target="_blank" rel="external">4种开始使用ES2015的方法</a></li>
<li><a href="https://www.codementor.io/javascript/tutorial/21-essential-javascript-tech-interview-practice-questions-answers" target="_blank" rel="external">最重要的21道面试题</a></li>
</ul>
</div></article></div></main><footer><div class="paginator"><a href="/post/2016/vieport-percentage/" class="prev">PREV</a><a href="/post/2016/cookie-localstorage-session/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2020 <a href="https://blog.colafornia.me">Colafornia</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-84469017-1",'auto');ga('send','pageview');</script></body></html>